<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Episode</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Ваши существующие стили */

        /* Стили для кастомных комментариев */
        #custom-comments {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .custom-comment {
            background-color: #3a3a3a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .comment-author {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .comment-author img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .comment-author span {
            color: #ff6a00;
            font-weight: bold;
        }

        .comment-text {
            color: #ffffff;
            font-size: 1rem;
            line-height: 1.5;
        }

        .comment-date {
            color: #888;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .comment-form {
            margin-top: 20px;
        }

        .comment-form textarea {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #444;
            background-color: #3a3a3a;
            color: #ffffff;
            resize: none;
            margin-bottom: 10px;
        }

        .comment-form button {
            background-color: #ff6a00;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .comment-form button:hover {
            background-color: #ee0979;
        }
    </style>
    <!-- Подключение SDK ВКонтакте -->
    <script type="text/javascript" src="https://vk.com/js/api/openapi.js?168"></script>
    <script type="text/javascript">
        // Инициализация ВКонтакте
        VK.init({ apiId: 53003098 }); // Замените на ваш apiId
    </script>
</head>
<body>
    <header>
        <div class="header-container">
            <h1><a href="index.html">Anime Watch</a></h1>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search anime...">
                <button onclick="performSearch()">Search</button>
            </div>
        </div>
    </header>

    <div class="search-results" id="search-results" style="display: none;"></div>

    <div class="container">
        <!-- Video Section -->
        <div class="video-section">
            <h1 id="anime-title"></h1>
            <h2 id="season-title"></h2>
            <iframe id="anime-video" width="100%" height="500px" frameborder="0" allowfullscreen></iframe>

            <!-- Description under the video -->
            <div class="anime-description" id="anime-description"></div>

            <!-- Comments Section -->
            <div class="comments-section">
                <h3>Comments</h3>
                <div id="custom-comments">
                    <!-- Кастомные комментарии будут здесь -->
                </div>
                <div class="comment-form">
                    <textarea id="comment-input" placeholder="Напишите комментарий..."></textarea>
                    <button onclick="addComment()">Отправить</button>
                </div>
                <div id="login-message" style="display: none;">
                    <p>Чтобы оставлять комментарии, <a href="#" onclick="loginVK()">войдите через ВКонтакте</a>.</p>
                </div>
            </div>
        </div>

        <!-- Season List Section -->
        <div class="season-list">
            <h3>Seasons</h3>
            <ul id="season-list"></ul>

            <!-- Films Section (only if films exist in the JSON) -->
            <div id="films-section" style="display: none;">
                <h3>Films</h3>
                <ul id="films-list"></ul>
            </div>
        </div>
    </div>

    <script>
        // Скрываем оригинальный виджет ВКонтакте
        document.getElementById('vk_comments').style.display = 'none';

        // Функция для получения комментариев
        function fetchComments() {
            const ownerId = -GROUP_ID; // Замените на ID вашей группы или пользователя
            const postId = POST_ID;    // Замените на ID поста

            VK.Api.call('wall.getComments', {
                owner_id: ownerId,
                post_id: postId,
                extended: 1,
                v: '5.131'
            }, function(response) {
                if (response.response) {
                    const comments = response.response.items;
                    displayComments(comments);
                }
            });
        }

        // Функция для отображения комментариев
        function displayComments(comments) {
            const commentsContainer = document.getElementById('custom-comments');
            commentsContainer.innerHTML = ''; // Очищаем контейнер

            comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'custom-comment';

                commentElement.innerHTML = `
                    <div class="comment-author">
                        <img src="${comment.from_id.photo_50}" alt="${comment.from_id.first_name} ${comment.from_id.last_name}">
                        <span>${comment.from_id.first_name} ${comment.from_id.last_name}</span>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-date">${new Date(comment.date * 1000).toLocaleString()}</div>
                `;

                commentsContainer.appendChild(commentElement);
            });
        }

        // Функция для отправки комментариев
        function addComment() {
            const message = document.getElementById('comment-input').value;
            const ownerId = -GROUP_ID; // Замените на ID вашей группы или пользователя
            const postId = POST_ID;    // Замените на ID поста

            VK.Api.call('wall.addComment', {
                owner_id: ownerId,
                post_id: postId,
                message: message,
                v: '5.131'
            }, function(response) {
                if (response.response) {
                    console.log('Комментарий добавлен:', response.response);
                    fetchComments(); // Обновляем список комментариев
                }
            });
        }

        // Проверка авторизации при загрузке страницы
        function checkAuth() {
            VK.Auth.getLoginStatus(function(response) {
                if (response.session) {
                    // Пользователь авторизован
                    document.getElementById('login-message').style.display = 'none';
                    fetchComments(); // Загружаем комментарии
                } else {
                    // Пользователь не авторизован
                    document.getElementById('login-message').style.display = 'block';
                }
            });
        }

        // Инициализация при загрузке страницы
        window.onload = function() {
            checkAuth();
        };
    </script>
</body>
</html>
